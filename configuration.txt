# requirements.txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
duckdb==0.9.2
python-multipart==0.0.6
python-dotenv==1.0.0

# .env (example environment file)
MOTHERDUCK_TOKEN=your_motherduck_token_here
DATABASE_URL=md:flavorlens
LOG_LEVEL=info

# Dockerfile
FROM python:3.11-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Expose port
EXPOSE 8000

# Run the application
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

# docker-compose.yml
version: '3.8'

services:
  flavorlens-api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - MOTHERDUCK_TOKEN=${MOTHERDUCK_TOKEN}
      - DATABASE_URL=${DATABASE_URL}
      - LOG_LEVEL=${LOG_LEVEL}
    env_file:
      - .env
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

# project_structure.md
# FastAPI FlavorLens Project Structure

```
flavorlens-api/
├── main.py                          # FastAPI main application
├── requirements.txt                 # Python dependencies
├── Dockerfile                       # Docker configuration
├── docker-compose.yml              # Docker Compose configuration
├── .env                            # Environment variables
├── README.md                       # Project documentation
├── database/
│   ├── __init__.py
│   ├── connection.py               # Database connection and query utilities
│   └── models.py                   # Pydantic models for API responses
├── routers/
│   ├── __init__.py
│   ├── texture_router.py           # Texture attributes endpoints
│   ├── temperature_router.py       # Serving temperature endpoints
│   ├── geographic_router.py        # Geographic distribution endpoints
│   ├── format_router.py            # Format adoption endpoints
│   ├── applications_router.py      # Applications dashboard endpoints
│   ├── category_router.py          # Category distribution endpoints
│   ├── subcategory_router.py       # Subcategory trends endpoints
│   ├── recipe_share_router.py      # Recipe share endpoints
│   ├── menu_share_router.py        # Menu share endpoints
│   ├── lifecycle_router.py         # Lifecycle position endpoints
│   ├── flavor_profile_router.py    # Flavor profile endpoints
│   ├── cuisine_router.py           # Cuisine distribution endpoints
│   ├── category_penetration_router.py  # Category penetration endpoints
│   └── trending_router.py          # Trending applications endpoints
└── logs/                           # Application logs directory
```

# README.md

# FlavorLens FastAPI

A FastAPI application for ingredient analytics and food trend insights, converted from Next.js API routes.

## Features

- **Texture Analysis**: Get texture attributes and trends for ingredients
- **Temperature Distribution**: Analyze serving temperature preferences
- **Geographic Insights**: Understand global adoption patterns
- **Format Analysis**: Track ingredient format adoption
- **Application Tracking**: Monitor ingredient applications across categories
- **Lifecycle Analysis**: Track ingredient adoption phases and seasonality
- **Flavor Profiling**: Deep flavor analysis and sensory dimensions
- **Cuisine Distribution**: See how ingredients are used across cuisines
- **Trend Analysis**: Identify trending applications and innovation opportunities

## Quick Start

### Using Docker (Recommended)

1. Clone the repository:
```bash
git clone <repository-url>
cd flavorlens-api
```

2. Create environment file:
```bash
cp .env.example .env
# Edit .env with your MotherDuck token
```

3. Run with Docker Compose:
```bash
docker-compose up -d
```

The API will be available at `http://localhost:8000`

### Local Development

1. Install dependencies:
```bash
pip install -r requirements.txt
```

2. Set environment variables:
```bash
export MOTHERDUCK_TOKEN=your_token_here
```

3. Run the application:
```bash
uvicorn main:app --reload
```

## API Documentation

Once running, visit:
- Interactive API docs: `http://localhost:8000/docs`
- ReDoc documentation: `http://localhost:8000/redoc`

## API Endpoints

### Core Endpoints

- `GET /api/texture-attributes?ingredient={name}` - Texture analysis
- `GET /api/serving-temperature?ingredient={name}` - Temperature distribution
- `GET /api/geographic-distribution?ingredient={name}` - Geographic insights
- `GET /api/format-adoption?ingredient={name}` - Format adoption data
- `GET /api/applications?ingredient={name}&category={category}` - Application analysis
- `GET /api/category-distribution?ingredient={name}` - Category breakdown
- `GET /api/subcategory-trends?ingredient={name}` - Trend analysis over time
- `GET /api/recipe-share?ingredient={name}` - Recipe market share
- `GET /api/menu-share?ingredient={name}` - Menu market share
- `GET /api/lifecycle-position?ingredient={name}` - Adoption lifecycle analysis
- `GET /api/flavor-profile?ingredient={name}` - Comprehensive flavor profiling
- `GET /api/cuisine-distribution?ingredient={name}` - Cuisine usage patterns
- `GET /api/category-penetration?ingredient={name}` - Market penetration analysis
- `GET /api/trending-applications?ingredient={name}` - Trending applications and opportunities

### Health Check

- `GET /health` - API health status
- `GET /` - Root endpoint

## Database Configuration

The application connects to MotherDuck (cloud DuckDB) by default. Configure your connection:

```env
MOTHERDUCK_TOKEN=your_motherduck_token
DATABASE_URL=md:flavorlens
```

For local development, you can use a local DuckDB file by omitting the MotherDuck token.

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `MOTHERDUCK_TOKEN` | MotherDuck authentication token | None |
| `DATABASE_URL` | Database connection string | `md:flavorlens` |
| `LOG_LEVEL` | Logging level | `info` |

## Performance Features

- **Query Caching**: Built-in caching for database queries with configurable TTL
- **Connection Pooling**: Efficient database connection management
- **Async Operations**: Full async support for concurrent request handling
- **Response Compression**: Automatic response compression for large datasets

## Error Handling

The API includes comprehensive error handling:
- Database connection failures fall back gracefully
- Invalid parameters return descriptive error messages
- All endpoints include proper HTTP status codes
- Detailed error logging for debugging

## Development

### Project Structure

```python
from database.connection import execute_query, QueryOptions
from database.models import YourModel
from fastapi import APIRouter, HTTPException, Query

router = APIRouter()

@router.get("/your-endpoint", response_model=YourModel)
async def your_endpoint(ingredient: str = Query(...)):
    try:
        query = "SELECT * FROM table WHERE ingredient ILIKE %s"
        result = await execute_query(
            query, 
            [f"%{ingredient}%"],
            options=QueryOptions(cacheable=True, ttl=3600000)
        )
        return process_result(result)
    except Exception as e:
        raise HTTPException(status_code=500, detail="Error message")
```

### Adding New Endpoints

1. Create a new router file in `routers/`
2. Define Pydantic models in `database/models.py`
3. Add the router to `main.py`
4. Write your database queries using the `execute_query` function

### Testing

```bash
# Install test dependencies
pip install pytest pytest-asyncio httpx

# Run tests
pytest
```

## Production Deployment

### Docker Deployment

```bash
# Build and push to registry
docker build -t flavorlens-api .
docker push your-registry/flavorlens-api

# Deploy with environment variables
docker run -d \
  -p 8000:8000 \
  -e MOTHERDUCK_TOKEN=your_token \
  -e LOG_LEVEL=info \
  your-registry/flavorlens-api
```

### Kubernetes Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: flavorlens-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: flavorlens-api
  template:
    metadata:
      labels:
        app: flavorlens-api
    spec:
      containers:
      - name: api
        image: your-registry/flavorlens-api
        ports:
        - containerPort: 8000
        env:
        - name: MOTHERDUCK_TOKEN
          valueFrom:
            secretKeyRef:
              name: flavorlens-secrets
              key: motherduck-token
```

## Performance Considerations

- Database queries are optimized for DuckDB/MotherDuck
- Caching is enabled by default with 1-hour TTL for most endpoints
- Use connection pooling in production environments
- Consider adding rate limiting for public APIs
- Monitor query performance and optimize slow queries

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Submit a pull request

## License

[Your License Here]

# Additional Configuration Files

# .gitignore
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

# PyInstaller
*.manifest
*.spec

# Unit test / coverage reports
htmlcov/
.tox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
.hypothesis/
.pytest_cache/

# Environment variables
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/

# IDEs
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Logs
logs/
*.log

# Database files
*.db
*.sqlite
*.sqlite3

# Docker
.dockerignore

# App specific
cache/
temp/